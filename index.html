<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bernau Games - Flappy Bird</title>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; }
    body { font-family:sans-serif; background:#222; }
    canvas { display:block; }
    .overlay {
      position:absolute; top:0; left:0; width:100%; height:100%; display:flex;
      justify-content:center; align-items:center; background:rgba(0,0,0,0.7);
      z-index:10; flex-direction:column; color:white; overflow:auto;
    }
    .overlay button { margin-top:10px; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; }
    .close-btn { position:absolute; top:10px; right:20px; background:#ff4444; border:none; border-radius:50%; width:30px; height:30px; color:white; font-weight:bold; cursor:pointer; }
    #shopOverlay ul { max-height:70%; overflow-y:auto; width:80%; }
    #shopOverlay li { margin:10px; padding:10px; background:#333; border-radius:8px; display:flex; justify-content:space-between; align-items:center; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<!-- Intro Overlay -->
<div id="introOverlay" class="overlay">
  <button class="close-btn" id="closeIntroBtn">X</button>
  <h1>Willkommen zu Bernau Games - Flappy Bird ðŸŽ‰</h1>
  <p>DrÃ¼cke <b>Leertaste</b>, um loszufliegen!</p>
  <p>Mit <b>S</b> Ã¶ffnest/schlieÃŸt du den Shop.</p>
  <button id="startBtn">OK, los gehtâ€™s!</button>
</div>

<!-- Shop Overlay -->
<div id="shopOverlay" class="overlay" style="display:none">
  <button class="close-btn" id="closeShopBtn">X</button>
  <h2>ðŸ›’ Shop</h2>
  <ul id="shopItems"></ul>
</div>

<script>
// Vollbild Canvas
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Game variables
let gameRunning = false;
let showIntro = true;
let showShop = false;
let score = 0;
let highScore = localStorage.getItem('flappyHighScore') || 0;

// Bird
let birdY, birdX, birdVY;
let gravity = 0.5, flapStrength = -8;
let currentSkin = 0;

// Skins & Shop
let coins = 0;
const birdSkins = [];
for(let i=0;i<50;i++){
  birdSkins.push({name:`Skin ${i+1}`, color:`hsl(${i*7},70%,50%)`, shape:'circle', price: i*10+10, purchased:false});
}

// Pipes & Coins
let pipes = [];
let pipeWidth = 80;
let pipeGap = 200;
let pipeSpeed = 3;

// Music
const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.2;
let musicOn = true;
bgMusic.play();

// Overlays
const introOverlay = document.getElementById('introOverlay');
const shopOverlay = document.getElementById('shopOverlay');
const shopItemsList = document.getElementById('shopItems');

function startGame(){
  showIntro = false;
  introOverlay.style.display='none';
  gameRunning=true;
  birdX = canvas.width/4;
  birdY = canvas.height/2;
  birdVY=0;
  score=0;
  pipes=[];
  spawnPipe();
}

function toggleShop(){
  showShop = !showShop;
  shopOverlay.style.display = showShop ? 'flex' : 'none';
  renderShop();
}

function renderShop(){
  shopItemsList.innerHTML='';
  birdSkins.forEach((skin,index)=>{
    const li = document.createElement('li');
    li.innerHTML = `<span style='color:${skin.color}'>${skin.name} (${skin.price} MÃ¼nzen)</span>`;
    const btn = document.createElement('button');
    btn.textContent = skin.purchased?'AuswÃ¤hlen':'Kaufen';
    btn.onclick = ()=>{
      if(!skin.purchased){
        if(coins>=skin.price){
          coins -= skin.price;
          skin.purchased=true;
          currentSkin = index;
          renderShop();
        }else alert('Nicht genug MÃ¼nzen!');
      } else {
        currentSkin = index;
      }
    };
    li.appendChild(btn);
    shopItemsList.appendChild(li);
  });
}

// Pipes
function spawnPipe(){
  let pipeY = Math.random()*(canvas.height-pipeGap-100)+50;
  pipes.push({x:canvas.width, y:pipeY});
}

// Game loop
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(gameRunning){
    // Bird physics
    birdVY+=gravity;
    birdY+=birdVY;

    // Draw bird
    const skin = birdSkins[currentSkin];
    ctx.fillStyle = skin.color;
    if(skin.shape==='circle') ctx.beginPath(),ctx.arc(birdX,birdY,20,0,Math.PI*2),ctx.fill();
    else if(skin.shape==='triangle') ctx.beginPath(),ctx.moveTo(birdX,birdY-20),ctx.lineTo(birdX-20,birdY+20),ctx.lineTo(birdX+20,birdY+20),ctx.fill();

    // Pipes
    for(let i=pipes.length-1;i>=0;i--){
      const p = pipes[i];
      p.x-=pipeSpeed;
      ctx.fillStyle='green';
      ctx.fillRect(p.x,0,pipeWidth,p.y);
      ctx.fillRect(p.x,p.y+pipeGap,pipeWidth,canvas.height);

      // Coin in gap
      ctx.fillStyle='gold';
      ctx.beginPath();
      ctx.arc(p.x+pipeWidth/2,p.y+pipeGap/2,10,0,Math.PI*2);
      ctx.fill();
      // Collect coin
      if(Math.abs((p.x+pipeWidth/2)-birdX)<20 && Math.abs((p.y+pipeGap/2)-birdY)<20){
        coins++;
        p.y=-1000; // Remove coin after collection
      }

      // Collision
      if(birdX+20>p.x && birdX-20<p.x+pipeWidth && (birdY-20<p.y || birdY+20>p.y+pipeGap)){
        gameOver();
      }

      if(p.x+pipeWidth<0) pipes.splice(i,1);
    }

    // Spawn new pipe
    if(pipes.length===0 || pipes[pipes.length-1].x<canvas.width-300) spawnPipe();

    // Score
    ctx.fillStyle='white';
    ctx.font='30px sans-serif';
    ctx.fillText(`Score: ${score}`,20,50);
    ctx.fillText(`MÃ¼nzen: ${coins}`,20,90);
    score++;
  }

  requestAnimationFrame(gameLoop);
}

function flap(){
  if(!showIntro && !showShop) birdVY=flapStrength;
}

function gameOver(){
  gameRunning=false;
  if(score>highScore){
    highScore=score;
    localStorage.setItem('flappyHighScore',highScore);
  }
  alert(`Game Over! Score: ${score} | Highscore: ${highScore}`);
  startGame();
}

// Controls
document.addEventListener('keydown',(e)=>{
  if(e.code==='Space'){ flap(); if(showIntro) startGame(); }
  if(e.code==='KeyS' && !showIntro) toggleShop();
  if(e.code==='Escape'){ showIntro=false; introOverlay.style.display='none'; showShop=false; shopOverlay.style.display='none'; }
  if(e.code==='KeyM'){ musicOn=!musicOn; bgMusic.volume=musicOn?0.2:0; }
});

// Buttons
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('closeIntroBtn').addEventListener('click', startGame);
document.getElementById('closeShopBtn').addEventListener('click',()=>{ showShop=false; shopOverlay.style.display='none'; });

// Start loop
gameLoop();
</script>
</body>
</html>
